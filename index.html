<br>
<br>
<br>

<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>VINCLE ‚Äî Conversaci√≥n sin nombres</title>
  <style>
    :root{
      --bg:#0f1720;
      --card:#0b1220;
      --accent:#60a5fa;
      --muted:#94a3b8;
      --bubble:#111827;
      --glass: rgba(255,255,255,0.03);
      color-scheme: dark;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:20;font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
    body{background:linear-gradient(180deg,#071028 0%, #081126 60%);display:flex;align-items:center;justify-content:center;padding:18px;}
    .app{width:100%;max-width:900px;height:90vh;background:var(--card);border-radius:14px;display:grid;grid-template-columns:320px 1fr;overflow:hidden;box-shadow:0 10px 30px rgba(2,6,23,0.6);position:relative;}

    /* panel lateral */
    .panel{padding:18px;color:#e6eef8;border-right:1px solid rgba(255,255,255,0.03);display:flex;flex-direction:column;gap:12px;background:var(--card);}
    .brand{display:flex;gap:10px;align-items:center}
    .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#7dd3fc);display:flex;align-items:center;justify-content:center;font-weight:700;color:#021;box-shadow:0 6px 18px rgba(6,12,30,0.6)}
    h1{font-size:18px;margin:0}
    .muted{color:var(--muted);font-size:13px}
    .room-box{background:var(--glass);padding:12px;border-radius:10px;display:flex;flex-direction:column;gap:8px}
    input.room-input{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:inherit}
    .btn{padding:10px;border-radius:8px;border:none;background:var(--accent);color:#042;}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
    .small{font-size:13px}
    .meta{font-size:12px;color:var(--muted);margin-top:6px}

    /* chat area */
    .chat{display:flex;flex-direction:column;height:100%;position:relative;}
    .chat-header{padding:16px 14px;border-bottom:1px solid rgba(255,255,255,0.03);display:flex;justify-content:space-between;align-items:center;background:var(--card);}
    .room-title{font-weight:600}
    .chat-body{flex:1;padding:14px;overflow:auto;display:flex;flex-direction:column;gap:8px;background:
      linear-gradient(180deg, rgba(255,255,255,0.01), transparent);}
    .bubble{max-width:80%;padding:10px 12px;border-radius:12px;background:var(--bubble);color:#e6eef8;line-height:1.3;word-break:break-word;font-size:15px}
    .bubble.left{align-self:flex-start;border-bottom-left-radius:4px}
    .bubble.right{align-self:flex-end;border-bottom-right-radius:4px;background:linear-gradient(135deg,var(--accent),#7dd3fc);color:#021}
    .composer{padding:12px;border-top:1px solid rgba(255,255,255,0.03);display:flex;gap:8px;align-items:center;background:var(--card);}
    .composer input{flex:1;padding:14px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;font-size:16px}
    .meta-note{font-size:12px;color:var(--muted);padding:0 14px 10px}
    .info-line{display:flex;gap:8px;align-items:center;font-size:13px}
    .color-pill{width:12px;height:12px;border-radius:50%;display:inline-block}

    /* bot√≥n de men√∫ m√≥vil */
    #menuToggle{display:none;position:absolute;top:10px;left:10px;background:var(--accent);color:#021;border:none;border-radius:8px;padding:8px 10px;font-size:18px;font-weight:600;z-index:20;}

    /* panel flotante m√≥vil */
    .mobile-panel{
      position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);
      display:none;align-items:center;justify-content:center;z-index:15;
    }
    .mobile-panel .panel{
      width:90%;max-width:340px;max-height:90%;overflow:auto;border-radius:14px;
      border:none;box-shadow:0 0 25px rgba(0,0,0,0.5);
    }

    /* mobile */
    @media (max-width:800px){
      .app{grid-template-columns:1fr;height:96vh;position:relative;}
      .panel{display:none}
      #menuToggle{display:block;}
      .chat-header{padding-top:40px;} /* espacio extra arriba */
    }
  </style>
</head>
<body>
  <div class="app" role="application" aria-label="VINCLE chat an√≥nimo">
    <button id="menuToggle">‚ò∞</button>

    <!-- Panel lateral -->
    <div class="mobile-panel" id="mobilePanel">
      <aside class="panel">
        <div class="brand">
          <div class="logo">V</div>
          <div>
            <h1>VINCLE</h1>
            <div class="muted small">Habla sin nombre. Escucha sin juicio.</div>
          </div>
        </div>

        <div class="room-box" style="margin-top:6px">
          <label class="small muted">ID de sala (URL)</label>
          <input id="roomInput" class="room-input" placeholder="Escribe un id corto o deja vac√≠o para uno aleatorio" />
          <div style="display:flex;gap:8px;margin-top:6px">
            <button id="createBtn" class="btn">Crear sala</button>
            <button id="copyBtn" class="btn ghost">Copiar link</button>
          </div>
          <div class="meta">Comparte el enlace con quien quieras. Nadie necesita registrarse.</div>
        </div>

        <div style="margin-top:10px;display:flex;flex-direction:column;gap:8px">
          <div class="small muted">Tu identidad ef√≠mera</div>
          <div class="info-line">
            <span id="myEmoji">üî∑</span>
            <span id="myColor" class="color-pill"></span>
            <div style="flex:1">
              <div id="anonLabel" style="font-weight:600">An√≥nimo</div>
              <div class="muted small">Tu color y emoji cambian cada sesi√≥n</div>
            </div>
          </div>
        </div>

        <div style="margin-top:auto">
          <div class="small muted">Opciones</div>
          <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap">
            <button id="clearLocal" class="btn ghost">Limpiar chat</button>
            <button id="newRoomShort" class="btn ghost">Sala aleatoria</button>
          </div>
          <div class="meta small" style="margin-top:10px">
            Reglas Firebase en modo test para probar r√°pido.
          </div>
        </div>
        <button class="btn ghost" style="margin-top:12px" id="closePanel">Cerrar</button>
      </aside>
    </div>

    <!-- Chat principal -->
    <main class="chat" aria-live="polite">
      <div class="chat-header">
        <div>
          <div class="room-title" id="roomTitle">Sala ‚Äî (cargando...)</div>
          <div class="muted small" id="roomIdText">ID: ‚Äî</div>
        </div>
        <div class="muted small">Expira: <span id="expiryLabel">24h</span></div>
      </div>

      <div class="chat-body" id="messages" role="log" aria-live="polite"></div>

      <div class="meta-note muted small">Los mensajes se borran tras 24h (modo demo).</div>

      <div class="composer" role="region" aria-label="Componer mensaje">
        <input id="textInput" placeholder="Escribe algo..." autocomplete="off" />
        <button id="sendBtn" class="btn">Enviar</button>
      </div>
    </main>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script>
  const firebaseConfig = {
    apiKey: "AIzaSyXMvncuf1Jhux5dVzDJ_VQe3cw3tIntt",
    authDomain: "vincle-e76dd.firebaseapp.com",
    databaseURL: "https://vincle-e76dd-default-rtdb.firebaseio.com",
    projectId: "vincle-e76dd",
    storageBucket: "vincle-e76dd.firebasestorage.app",
    messagingSenderId: "11807936515",
    appId: "1:11807936515:web:ff67d9da38e956ff62cee6"
  };
  firebase.initializeApp(firebaseConfig);

  const MESSAGE_EXPIRY_HOURS = 24;
  const ROOM_PARAM = new URLSearchParams(location.search).get('room');
  const DEFAULT_ROOM = ROOM_PARAM || localStorage.getItem('vincle_room') || null;

  const roomInput=document.getElementById('roomInput');
  const createBtn=document.getElementById('createBtn');
  const copyBtn=document.getElementById('copyBtn');
  const messagesEl=document.getElementById('messages');
  const textInput=document.getElementById('textInput');
  const sendBtn=document.getElementById('sendBtn');
  const roomTitle=document.getElementById('roomTitle');
  const roomIdText=document.getElementById('roomIdText');
  const myColorEl=document.getElementById('myColor');
  const myEmojiEl=document.getElementById('myEmoji');
  const newRoomShort=document.getElementById('newRoomShort');
  const clearLocal=document.getElementById('clearLocal');
  const expiryLabel=document.getElementById('expiryLabel');
  expiryLabel.textContent = MESSAGE_EXPIRY_HOURS + "h";

  const COLORS=['#f97316','#fb7185','#60a5fa','#34d399','#f59e0b','#a78bfa','#ef4444'];
  const EMOJIS=['üî∑','üî∂','üî∫','üîµ','üü£','üü¢','üåø','‚ú®','‚ö°','üåô','‚òÄÔ∏è','üî•'];
  function pick(a){return a[Math.floor(Math.random()*a.length)]}
  const sessionColor=sessionStorage.getItem('vincle_color')||pick(COLORS);
  const sessionEmoji=sessionStorage.getItem('vincle_emoji')||pick(EMOJIS);
  sessionStorage.setItem('vincle_color',sessionColor);
  sessionStorage.setItem('vincle_emoji',sessionEmoji);
  myColorEl.style.background=sessionColor;myEmojiEl.textContent=sessionEmoji;

  function randomId(l=6){const c='abcdefghijklmnopqrstuvwxyz0123456789';let s='';for(let i=0;i<l;i++)s+=c[Math.floor(Math.random()*c.length)];return s;}
  let ROOM=DEFAULT_ROOM||null;
  function setRoom(r){ROOM=r;roomTitle.textContent=`Sala ‚Äî ${r||'(sin id)'}`;roomIdText.textContent=`ID: ${r||'‚Äî'}`;roomInput.value=r||'';if(r){const url=location.origin+location.pathname+'?room='+encodeURIComponent(r);history.replaceState(null,'','?room='+encodeURIComponent(r));localStorage.setItem('vincle_room',r);}}
  function dbRefForRoom(room){return firebase.database().ref('rooms/'+room+'/messages');}
  function sendMessage(text){
    if(!text.trim())return;
    const now=Date.now(),expiry=now+MESSAGE_EXPIRY_HOURS*3600000;
    const payload={text:text.trim().slice(0,2000),color:sessionColor,emoji:sessionEmoji,ts:now,expiry};
    dbRefForRoom(ROOM).push(payload);
  }
  function createBubble(msg,mine=false){
    const div=document.createElement('div');div.className='bubble '+(mine?'right':'left');
    const meta=document.createElement('div');meta.style.display='flex';meta.style.alignItems='center';meta.style.gap='8px';meta.style.marginBottom='6px';
    const pill=document.createElement('span');pill.className='color-pill';pill.style.background=msg.color||'#666';meta.appendChild(pill);
    const em=document.createElement('span');em.textContent=msg.emoji||'üî∑';meta.appendChild(em);
    const text=document.createElement('div');text.textContent=msg.text;
    const t=document.createElement('div');t.className='muted small';t.style.fontSize='11px';t.style.marginTop='6px';t.textContent=new Date(msg.ts||Date.now()).toLocaleString();
    div.append(meta,text,t);return div;
  }
  function startListening(){
    messagesEl.innerHTML='';
    const db=dbRefForRoom(ROOM);
    db.limitToLast(200).on('child_added',s=>{
      const msg=s.val();if(!msg)return;
      if(msg.expiry && Date.now()>msg.expiry)return;
      const mine=(msg.color===sessionColor && msg.emoji===sessionEmoji);
      const bubble=createBubble(msg,mine);messagesEl.appendChild(bubble);
      messagesEl.scrollTop=messagesEl.scrollHeight;
    });
  }
  createBtn.onclick=()=>{let id=(roomInput.value||'').trim();if(!id)id=randomId(7);setRoom(id);startListening();navigator.clipboard?.writeText(location.origin+location.pathname+'?room='+id);}
  copyBtn.onclick=()=>{if(!ROOM)return alert('Crea o entra a una sala.');navigator.clipboard?.writeText(location.origin+location.pathname+'?room='+ROOM);}
  newRoomShort.onclick=()=>{setRoom(randomId(7));startListening();}
  clearLocal.onclick=()=>messagesEl.innerHTML='';
  sendBtn.onclick=()=>{if(textInput.value.trim()){sendMessage(textInput.value);textInput.value='';}}
  textInput.addEventListener('keydown',e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendBtn.click();}});
  if(ROOM){setRoom(ROOM);startListening();}else roomInput.placeholder='ej: charla, '+randomId(4);

  // M√≥vil: panel
  const mobilePanel=document.getElementById('mobilePanel');
  document.getElementById('menuToggle').onclick=()=>mobilePanel.style.display='flex';
  document.getElementById('closePanel').onclick=()=>mobilePanel.style.display='none';
  </script>
</body>
</html>


